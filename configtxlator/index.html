<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Channel Reconfiguration - Hyperledger Fabric Documentaion</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Channel Reconfiguration";
    var mkdocs_page_input_path = "configtxlator.md";
    var mkdocs_page_url = "/configtxlator/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Hyperledger Fabric Documentaion</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../blockchain/">Key blockchain concepts</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Developing blockchain applications</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../fabric-sdks/">Applications and the Hyperledger Fabric SDKs</a>
                </li>
                <li class="">
                    
    <a class="" href="../chaincode/">Programming Smart contracts and Chaincode</a>
                </li>
                <li class="">
                    
    <a class="" href="../txflow/">Transaction Flow</a>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Accessing the ledger</a>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Querying the ledger</a>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Updating the ledger</a>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Ledger notifications</a>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Accessing the transaction log</a>
                </li>
                <li class="">
                    
    <a class="" href="../peer-chaincode-devmode/">Running Chaincode in Development Mode</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Administering a blockchain network</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../tbd/">Network Tasks</a>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Consortium Tasks</a>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Organization Tasks</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Peer Tasks</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../endorsement-policies/">Endorsement Policy Tasks</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Orderer Tasks</a>
                </li>
                <li class="">
                    
    <a class="" href="../msp/">Managing Identity</a>
                </li>
                <li class=" current">
                    
    <span class="caption-text">Channel Tasks</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../configtx/">Channel Configuration</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../configtxgen/">Generating Channel Configuration</a>
                </li>
                <li class="toctree-l3 current">
                    
    <a class="current" href="./">Channel Reconfiguration</a>
    <ul class="subnav">
            
    <li class="toctree-l4"><a href="#reconfiguring-with-configtxlator">Reconfiguring with configtxlator</a></li>
    
        <ul>
        
            <li><a class="toctree-l5" href="#overview">Overview</a></li>
        
            <li><a class="toctree-l5" href="#running-the-configtxlator">Running the configtxlator</a></li>
        
            <li><a class="toctree-l5" href="#bootstraping-example">Bootstraping example</a></li>
        
            <li><a class="toctree-l5" href="#reconfiguration-example">Reconfiguration example</a></li>
        
            <li><a class="toctree-l5" href="#adding-an-organization">Adding an organization</a></li>
        
        </ul>
    

    </ul>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Certificate Authority Tasks</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Tutorials and samples</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../getting_started/">Getting Started</a>
                </li>
                <li class="">
                    
    <a class="" href="../build_network/">Build Your First Network</a>
                </li>
                <li class="">
                    
    <a class="" href="../write_first_app/">Writing Your First Application</a>
                </li>
                <li class="">
                    
    <a class="" href="../chaincode4ade/">Chaincode for Developers</a>
                </li>
                <li class="">
                    
    <a class="" href="../chaincode4noah/">Chaincode for Operations</a>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">DRIVENET Tutorial</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Reference material</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../arch-deep-dive/">Architecture Explained</a>
                </li>
                <li class="">
                    
    <a class="" href="../capabilities/">Capabilities</a>
                </li>
                <li class="">
                    
    <a class="" href="../fabric_model/">Fabric Model</a>
                </li>
                <li class="">
                    
    <a class="" href="../channels/">Channels</a>
                </li>
                <li class="">
                    
    <a class="" href="../gossip/">Gossip</a>
                </li>
                <li class="">
                    
    <a class="" href="../glossary/">Glossary</a>
                </li>
                <li class="">
                    
    <a class="" href="../kafka/">Kafka</a>
                </li>
                <li class="">
                    
    <a class="" href="../ledger/">Ledger</a>
                </li>
                <li class="">
                    
    <a class="" href="../fabric-FAQ/">FAQ</a>
                </li>
                <li class="">
                    
    <a class="" href="../releases/">Release Notes</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../questions/">General Help</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../CONTRIBUTING/">Contributing</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Hyperledger Fabric Documentaion</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Administering a blockchain network &raquo;</li>
        
      
        
          <li>Channel Tasks &raquo;</li>
        
      
    
    <li>Channel Reconfiguration</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="reconfiguring-with-configtxlator">Reconfiguring with configtxlator</h1>
<h2 id="overview">Overview</h2>
<p>The <code>configtxlator</code> tool was created to support reconfiguration
independent of SDKs. Channel configuration is stored as a transaction in
configuration blocks of a channel and may be manipulated directly, such
as in the bdd behave tests. However, at the time of this writing, no SDK
natively supports manipulating the configuration directly, so the
<code>configtxlator</code> tool is designed to provide an API which consumers of
any SDK may interact with to assist with configuration updates.</p>
<p>The tool name is a portmanteau of <em>configtx</em> and <em>translator</em> and is
intended to convey that the tool simply converts between different
equivalent data representations. It does not generate configuration. It
does not submit or retrieve configuration. It does not modify
configuration itself, it simply provides some bijective operations
between different views of the configtx format.</p>
<p>The standard usage is expected to be:</p>
<blockquote>
<ol>
<li>SDK retrieves latest config</li>
<li><code>configtxlator</code> produces human readable version of config</li>
<li>User or application edits the config</li>
<li><code>configtxlator</code> is used to compute config update representation of
    changes to the config</li>
<li>SDK submits signs and submits config</li>
</ol>
</blockquote>
<p>The <code>configtxlator</code> tool exposes a truly stateless REST API for
interacting with configuration elements. These REST components support
converting the native configuration format to/from a human readable JSON
representation, as well as computing configuration updates based on the
difference between two configurations.</p>
<p>Because the <code>configtxlator</code> service deliberately does not contain any
crypto material, or otherwise secret information, it does not include
any authorization or access control. The anticipated typical deployment
would be to operate as a sandboxed container, locally with the
application, so that there is a dedicated <code>configtxlator</code> process for
each consumer of it.</p>
<h2 id="running-the-configtxlator">Running the configtxlator</h2>
<p>The <code>configtxlator</code> tool can be downloaded with the other Hyperledger
Fabric platform-specific binaries. Please see
[download-platform-specific-binaries]{role="ref"} for details.</p>
<p>The tool may be configured to listen on a different port and you may
also specify the hostname using the <code>--port</code> and <code>--hostname</code> flags. To
explore the complete set of commands and flags, run
<code>configtxlator --help</code>.</p>
<p>The binary will start an http server listening on the designated port
and is now ready to process request.</p>
<p>To start the <code>configtxlator</code> server:</p>
<p>``` {.sourceCode .bash}
configtxlator start
2017-06-21 18:16:58.248 HKT [configtxlator] startServer -&gt; INFO 001 Serving HTTP requests on 0.0.0.0:7059</p>
<pre><code>
Proto translation
-----------------

For extensibility, and because certain fields must be signed over, many
proto fields are stored as bytes. This makes the natural proto to JSON
translation using the `jsonpb` package ineffective for producing a human
readable version of the protobufs. Instead, the `configtxlator` exposes
a REST component to do a more sophisticated translation.

To convert a proto to its human readable JSON equivalent, simply post
the binary proto to the rest target
`http://$SERVER:$PORT/protolator/decode/&lt;message.Name&gt;`, where
`&lt;message.Name&gt;` is the fully qualified proto name of the message.

For instance, to decode a configuration block saved as
`configuration_block.pb`, run the command:

``` {.sourceCode .bash}
curl -X POST --data-binary @configuration_block.pb http://127.0.0.1:7059/protolator/decode/common.Block
</code></pre>

<p>To convert the human readable JSON version of the proto message, simply
post the JSON version to
<code>http://$SERVER:$PORT/protolator/encode/&lt;message.Name</code>, where
<code>&lt;message.Name&gt;</code> is again the fully qualified proto name of the message.</p>
<p>For instance, to re-encode the block saved as
<code>configuration_block.json</code>, run the command:</p>
<p>``` {.sourceCode .bash}
curl -X POST --data-binary @configuration_block.json http://127.0.0.1:7059/protolator/encode/common.Block</p>
<pre><code>
Any of the configuration related protos, including `common.Block`,
`common.Envelope`, `common.ConfigEnvelope`,
`common.ConfigUpdateEnvelope`, `common.Config`, and
`common.ConfigUpdate` are valid targets for these URLs. In the future,
other proto decoding types may be added, such as for endorser
transactions.

Config update computation
-------------------------

Given two different configurations, it is possible to compute the config
update which transitions between them. Simply POST the two
`common.Config` proto encoded configurations as `multipart/formdata`,
with the original as field `original` and the updated as field
`updated`, to
`http://$SERVER:$PORT/configtxlator/compute/update-from-configs`.

For example, given the original config as the file `original_config.pb`
and the updated config as the file `updated_config.pb` for the channel
`desiredchannel`:

``` {.sourceCode .bash}
curl -X POST -F channel=desiredchannel -F original=@original_config.pb -F updated=@updated_config.pb http://127.0.0.1:7059/configtxlator/compute/update-from-configs
</code></pre>

<h2 id="bootstraping-example">Bootstraping example</h2>
<p>First start the <code>configtxlator</code>:</p>
<p>``` {.sourceCode .bash}
$ configtxlator start
2017-05-31 12:57:22.499 EDT [configtxlator] main -&gt; INFO 001 Serving HTTP requests on port: 7059</p>
<pre><code>
First, produce a genesis block for the ordering system channel:

``` {.sourceCode .bash}
$ configtxgen -outputBlock genesis_block.pb
2017-05-31 14:15:16.634 EDT [common/configtx/tool] main -&gt; INFO 001 Loading configuration
2017-05-31 14:15:16.646 EDT [common/configtx/tool] doOutputBlock -&gt; INFO 002 Generating genesis block
2017-05-31 14:15:16.646 EDT [common/configtx/tool] doOutputBlock -&gt; INFO 003 Writing genesis block
</code></pre>

<p>Decode the genesis block into a human editable form:</p>
<p>``` {.sourceCode .bash}
curl -X POST --data-binary @genesis_block.pb http://127.0.0.1:7059/protolator/decode/common.Block &gt; genesis_block.json</p>
<pre><code>
Edit the `genesis_block.json` file in your favorite JSON editor, or
manipulate it programatically. Here we use the JSON CLI tool `jq`. For
simplicity, we are editing the batch size for the channel, because it is
a single numeric field. However, any edits, including policy and MSP
edits may be made here.

First, let\'s establish an environment variable to hold the string that
defines the path to a property in the json:

``` {.sourceCode .bash}
export MAXBATCHSIZEPATH=&quot;.data.data[0].payload.data.config.channel_group.groups.Orderer.values.BatchSize.value.max_message_count&quot;
</code></pre>

<p>Next, let\'s display the value of that property:</p>
<p>``` {.sourceCode .bash}
jq "$MAXBATCHSIZEPATH" genesis_block.json
10</p>
<pre><code>
Now, let\'s set the new batch size, and display the new value:

&gt; jq \&quot;\$MAXBATCHSIZEPATH = 20\&quot; genesis\_block.json \&gt;
&gt; updated\_genesis\_block.json jq \&quot;\$MAXBATCHSIZEPATH\&quot;
&gt; updated\_genesis\_block.json 20

The genesis block is now ready to be re-encoded into the native proto
form to be used for bootstrapping:

``` {.sourceCode .bash}
curl -X POST --data-binary @updated_genesis_block.json http://127.0.0.1:7059/protolator/encode/common.Block &gt; updated_genesis_block.pb
</code></pre>

<p>The <code>updated_genesis_block.pb</code> file may now be used as the genesis block
for bootstrapping an ordering system channel.</p>
<h2 id="reconfiguration-example">Reconfiguration example</h2>
<p>In another terminal window, start the orderer using the default options,
including the provisional bootstrapper which will create a <code>testchainid</code>
ordering system channel.</p>
<p>``` {.sourceCode .bash}
ORDERER_GENERAL_LOGLEVEL=debug orderer</p>
<pre><code>
Reconfiguring a channel can be performed in a very similar way to
modifying a genesis config.

First, fetch the config\_block proto:

``` {.sourceCode .bash}
$ peer channel fetch config config_block.pb -o 127.0.0.1:7050 -c testchainid
2017-05-31 15:11:37.617 EDT [msp] getMspConfig -&gt; INFO 001 intermediate certs folder not found at [/home/yellickj/go/src/github.com/hyperledger/fabric/sampleconfig/msp/intermediatecerts]. Skipping.: [stat /home/yellickj/go/src/github.com/hyperledger/fabric/sampleconfig/msp/intermediatecerts: no such file or directory]
2017-05-31 15:11:37.617 EDT [msp] getMspConfig -&gt; INFO 002 crls folder not found at [/home/yellickj/go/src/github.com/hyperledger/fabric/sampleconfig/msp/intermediatecerts]. Skipping.: [stat /home/yellickj/go/src/github.com/hyperledger/fabric/sampleconfig/msp/crls: no such file or directory]
Received block:  1
Received block:  1
2017-05-31 15:11:37.635 EDT [main] main -&gt; INFO 003 Exiting.....
</code></pre>

<p>Next, send the config block to the <code>configtxlator</code> service for decoding:</p>
<p>``` {.sourceCode .bash}
curl -X POST --data-binary @config_block.pb http://127.0.0.1:7059/protolator/decode/common.Block &gt; config_block.json</p>
<pre><code>
Extract the config section from the block:

``` {.sourceCode .bash}
jq .data.data[0].payload.data.config config_block.json &gt; config.json
</code></pre>

<p>Edit the config, saving it as a new <code>updated_config.json</code>. Here, we set
the batch size to 30.</p>
<p>``` {.sourceCode .bash}
jq ".channel_group.groups.Orderer.values.BatchSize.value.max_message_count = 30" config.json  &gt; updated_config.json</p>
<pre><code>
Re-encode both the original config, and the updated config into proto:

``` {.sourceCode .bash}
curl -X POST --data-binary @config.json http://127.0.0.1:7059/protolator/encode/common.Config &gt; config.pb
</code></pre>

<p>``` {.sourceCode .bash}
curl -X POST --data-binary @updated_config.json http://127.0.0.1:7059/protolator/encode/common.Config &gt; updated_config.pb</p>
<pre><code>
Now, with both configs properly encoded, send them to the configtxlator
service to compute the config update which transitions between the two.

``` {.sourceCode .bash}
curl -X POST -F original=@config.pb -F updated=@updated_config.pb http://127.0.0.1:7059/configtxlator/compute/update-from-configs -F channel=testchainid &gt; config_update.pb
</code></pre>

<p>At this point, the computed config update is now prepared.
Traditionally, an SDK would be used to sign and wrap this message.
However, in the interest of using only the peer cli, the configtxlator
can also be used for this task.</p>
<p>First, we decode the ConfigUpdate so that we may work with it as text:</p>
<p>``` {.sourceCode .bash}
$ curl -X POST --data-binary @config_update.pb http://127.0.0.1:7059/protolator/decode/common.ConfigUpdate &gt; config_update.json</p>
<pre><code>
Then, we wrap it in an envelope message:

``` {.sourceCode .bash}
echo '{&quot;payload&quot;:{&quot;header&quot;:{&quot;channel_header&quot;:{&quot;channel_id&quot;:&quot;testchainid&quot;, &quot;type&quot;:2}},&quot;data&quot;:{&quot;config_update&quot;:'$(cat config_update.json)'}}}' &gt; config_update_as_envelope.json
</code></pre>

<p>Next, convert it back into the proto form of a full fledged config
transaction:</p>
<p>``` {.sourceCode .bash}
curl -X POST --data-binary @config_update_as_envelope.json http://127.0.0.1:7059/protolator/encode/common.Envelope &gt; config_update_as_envelope.pb</p>
<pre><code>
Finally, submit the config update transaction to ordering to perform a
config update.

``` {.sourceCode .bash}
peer channel update -f config_update_as_envelope.pb -c testchainid -o 127.0.0.1:7050
</code></pre>

<h2 id="adding-an-organization">Adding an organization</h2>
<p>First start the <code>configtxlator</code>:</p>
<p>``` {.sourceCode .bash}
$ configtxlator start
2017-05-31 12:57:22.499 EDT [configtxlator] main -&gt; INFO 001 Serving HTTP requests on port: 7059</p>
<pre><code>
Start the orderer using the `SampleDevModeSolo` profile option.

``` {.sourceCode .bash}
ORDERER_GENERAL_LOGLEVEL=debug ORDERER_GENERAL_GENESISPROFILE=SampleDevModeSolo orderer
</code></pre>

<p>The process to add an organization then follows exactly like the batch
size example. However, instead of setting the batch size, a new org is
defined at the application level. Adding an organization is slightly
more involved because we must first create a channel, then modify its
membership set.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../tbd/" class="btn btn-neutral float-right" title="Certificate Authority Tasks">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../configtxgen/" class="btn btn-neutral" title="Generating Channel Configuration"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2017 Linux Foundation All Rights Reserved</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../configtxgen/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../tbd/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script>

</body>
</html>
