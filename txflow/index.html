<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Transaction Flow - Hyperledger Fabric Documentaion</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Transaction Flow";
    var mkdocs_page_input_path = "txflow.md";
    var mkdocs_page_url = "/txflow/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Hyperledger Fabric Documentaion</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../blockchain/">Key blockchain concepts</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Developing blockchain applications</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../fabric-sdks/">Applications and the Hyperledger Fabric SDKs</a>
                </li>
                <li class="">
                    
    <a class="" href="../chaincode/">Programming Smart contracts and Chaincode</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Transaction Flow</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#transaction-flow">Transaction Flow</a></li>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Accessing the ledger</a>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Querying the ledger</a>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Updating the ledger</a>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Ledger notifications</a>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Accessing the transaction log</a>
                </li>
                <li class="">
                    
    <a class="" href="../peer-chaincode-devmode/">Running Chaincode in Development Mode</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Administering a blockchain network</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../tbd/">Network Tasks</a>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Consortium Tasks</a>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Organization Tasks</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Peer Tasks</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../endorsement-policies/">Endorsement Policy Tasks</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Orderer Tasks</a>
                </li>
                <li class="">
                    
    <a class="" href="../msp/">Managing Identity</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Channel Tasks</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../configtx/">Channel Configuration</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../configtxgen/">Generating Channel Configuration</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../configtxlator/">Channel Reconfiguration</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Certificate Authority Tasks</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Tutorials and samples</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../getting_started/">Getting Started</a>
                </li>
                <li class="">
                    
    <a class="" href="../build_network/">Build Your First Network</a>
                </li>
                <li class="">
                    
    <a class="" href="../write_first_app/">Writing Your First Application</a>
                </li>
                <li class="">
                    
    <a class="" href="../chaincode4ade/">Chaincode for Developers</a>
                </li>
                <li class="">
                    
    <a class="" href="../chaincode4noah/">Chaincode for Operations</a>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">DRIVENET Tutorial</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Reference material</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../arch-deep-dive/">Architecture Explained</a>
                </li>
                <li class="">
                    
    <a class="" href="../capabilities/">Capabilities</a>
                </li>
                <li class="">
                    
    <a class="" href="../fabric_model/">Fabric Model</a>
                </li>
                <li class="">
                    
    <a class="" href="../channels/">Channels</a>
                </li>
                <li class="">
                    
    <a class="" href="../gossip/">Gossip</a>
                </li>
                <li class="">
                    
    <a class="" href="../glossary/">Glossary</a>
                </li>
                <li class="">
                    
    <a class="" href="../kafka/">Kafka</a>
                </li>
                <li class="">
                    
    <a class="" href="../ledger/">Ledger</a>
                </li>
                <li class="">
                    
    <a class="" href="../fabric-FAQ/">FAQ</a>
                </li>
                <li class="">
                    
    <a class="" href="../releases/">Release Notes</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../questions/">General Help</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../CONTRIBUTING/">Contributing</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Hyperledger Fabric Documentaion</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Developing blockchain applications &raquo;</li>
        
      
    
    <li>Transaction Flow</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="transaction-flow">Transaction Flow</h1>
<p>This document outlines the transactional mechanics that take place
during a standard asset exchange. The scenario includes two clients, A
and B, who are buying and selling radishes. They each have a peer on the
network through which they send their transactions and interact with the
ledger.</p>
<p><img alt="image" src="../images/step0.png" /></p>
<p><strong>Assumptions</strong></p>
<p>This flow assumes that a channel is set up and running. The application
user has registered and enrolled with the organization's certificate
authority (CA) and received back necessary cryptographic material, which
is used to authenticate to the network.</p>
<p>The chaincode (containing a set of key value pairs representing the
initial state of the radish market) is installed on the peers and
instantiated on the channel. The chaincode contains logic defining a set
of transaction instructions and the agreed upon price for a radish. An
endorsement policy has also been set for this chaincode, stating that
both <code>peerA</code> and <code>peerB</code> must endorse any transaction.</p>
<p><img alt="image" src="../images/step1.png" /></p>
<ol>
<li><strong>Client A initiates a transaction</strong></li>
</ol>
<p>What\'s happening? - Client A is sending a request to purchase radishes.
The request targets <code>peerA</code> and <code>peerB</code>, who are respectively
representative of Client A and Client B. The endorsement policy states
that both peers must endorse any transaction, therefore the request goes
to <code>peerA</code> and <code>peerB</code>.</p>
<p>Next, the transaction proposal is constructed. An application leveraging
a supported SDK (Node, Java, Python) utilizes one of the available
API\'s which generates a transaction proposal. The proposal is a request
to invoke a chaincode function so that data can be read and/or written
to the ledger (i.e. write new key value pairs for the assets). The SDK
serves as a shim to package the transaction proposal into the properly
architected format (protocol buffer over gRPC) and takes the user's
cryptographic credentials to produce a unique signature for this
transaction proposal.</p>
<p><img alt="image" src="../images/step2.png" /></p>
<ol>
<li><strong>Endorsing peers verify signature &amp; execute the transaction</strong></li>
</ol>
<p>The endorsing peers verify (1) that the transaction proposal is well
formed, (2) it has not been submitted already in the past (replay-attack
protection), (3) the signature is valid (using MSP), and (4) that the
submitter (Client A, in the example) is properly authorized to perform
the proposed operation on that channel (namely, each endorsing peer
ensures that the submitter satisfies the channel\'s <em>Writers</em> policy).
The endorsing peers take the transaction proposal inputs as arguments to
the invoked chaincode\'s function. The chaincode is then executed
against the current state database to produce transaction results
including a response value, read set, and write set. No updates are made
to the ledger at this point. The set of these values, along with the
endorsing peer's signature is passed back as a "proposal response" to
the SDK which parses the payload for the application to consume.</p>
<p><em>{The MSP is a peer component that allows them to verify transaction
requests arriving from clients and to sign transaction
results(endorsements). The Writing policy is defined at channel creation
time, and determines which user is entitled to submit a transaction to
that channel.}</em></p>
<p><img alt="image" src="../images/step3.png" /></p>
<ol>
<li><strong>Proposal responses are inspected</strong></li>
</ol>
<p>The application verifies the endorsing peer signatures and compares the
proposal responses to determine if the proposal responses are the same.
If the chaincode only queried the ledger, the application would inspect
the query response and would typically not submit the transaction to
Ordering Service. If the client application intends to submit the
transaction to Ordering Service to update the ledger, the application
determines if the specified endorsement policy has been fulfilled before
submitting (i.e. did peerA and peerB both endorse). The architecture is
such that even if an application chooses not to inspect responses or
otherwise forwards an unendorsed transaction, the endorsement policy
will still be enforced by peers and upheld at the commit validation
phase.</p>
<p><img alt="image" src="../images/step4.png" /></p>
<ol>
<li><strong>Client assembles endorsements into a transaction</strong></li>
</ol>
<p>The application "broadcasts" the transaction proposal and response
within a "transaction message" to the Ordering Service. The transaction
will contain the read/write sets, the endorsing peers signatures and the
Channel ID. The Ordering Service does not need to inspect the entire
content of a transaction in order to perform its operation, it simply
receives transactions from all channels in the network, orders them
chronologically by channel, and creates blocks of transactions per
channel.</p>
<p><img alt="image" src="../images/step5.png" /></p>
<ol>
<li><strong>Transaction is validated and committed</strong></li>
</ol>
<p>The blocks of transactions are "delivered" to all peers on the channel.
The transactions within the block are validated to ensure endorsement
policy is fulfilled and to ensure that there have been no changes to
ledger state for read set variables since the read set was generated by
the transaction execution. Transactions in the block are tagged as being
valid or invalid.</p>
<p><img alt="image" src="../images/step6.png" /></p>
<ol>
<li><strong>Ledger updated</strong></li>
</ol>
<p>Each peer appends the block to the channel's chain, and for each valid
transaction the write sets are committed to current state database. An
event is emitted, to notify the client application that the transaction
(invocation) has been immutably appended to the chain, as well as
notification of whether the transaction was validated or invalidated.</p>
<p><strong>Note</strong>: See the [swimlane]{role="ref"} diagram to better understand
the server side flow and the protobuffers.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../tbd/" class="btn btn-neutral float-right" title="Accessing the ledger">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../chaincode/" class="btn btn-neutral" title="Programming Smart contracts and Chaincode"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2017 Linux Foundation All Rights Reserved</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../chaincode/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../tbd/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script>

</body>
</html>
