<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../img/favicon.ico">
  <title>Writing Your First Application - Hyperledger Fabric Documentaion</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../css/highlight.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Writing Your First Application";
    var mkdocs_page_input_path = "write_first_app.md";
    var mkdocs_page_url = "/write_first_app/";
  </script>
  
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../js/highlight.pack.js"></script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href=".." class="icon icon-home"> Hyperledger Fabric Documentaion</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="..">Home</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../blockchain/">Key blockchain concepts</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Developing blockchain applications</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../fabric-sdks/">Applications and the Hyperledger Fabric SDKs</a>
                </li>
                <li class="">
                    
    <a class="" href="../chaincode/">Programming Smart contracts and Chaincode</a>
                </li>
                <li class="">
                    
    <a class="" href="../txflow/">Transaction Flow</a>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Accessing the ledger</a>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Querying the ledger</a>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Updating the ledger</a>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Ledger notifications</a>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Accessing the transaction log</a>
                </li>
                <li class="">
                    
    <a class="" href="../peer-chaincode-devmode/">Running Chaincode in Development Mode</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Administering a blockchain network</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../tbd/">Network Tasks</a>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Consortium Tasks</a>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Organization Tasks</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Peer Tasks</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../endorsement-policies/">Endorsement Policy Tasks</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Orderer Tasks</a>
                </li>
                <li class="">
                    
    <a class="" href="../msp/">Managing Identity</a>
                </li>
                <li class="">
                    
    <span class="caption-text">Channel Tasks</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../configtx/">Channel Configuration</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../configtxgen/">Generating Channel Configuration</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../configtxlator/">Channel Reconfiguration</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">Certificate Authority Tasks</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Tutorials and samples</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../getting_started/">Getting Started</a>
                </li>
                <li class="">
                    
    <a class="" href="../build_network/">Build Your First Network</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Writing Your First Application</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#writing-your-first-application">Writing Your First Application</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#setting-up-your-dev-environment">Setting up your Dev Environment</a></li>
        
            <li><a class="toctree-l4" href="#how-applications-interact-with-the-network">How Applications Interact with the Network</a></li>
        
            <li><a class="toctree-l4" href="#enrolling-the-admin-user">Enrolling the Admin User</a></li>
        
            <li><a class="toctree-l4" href="#register-and-enroll-user1">Register and Enroll user1</a></li>
        
            <li><a class="toctree-l4" href="#updating-the-ledger">Updating the Ledger</a></li>
        
            <li><a class="toctree-l4" href="#summary">Summary</a></li>
        
            <li><a class="toctree-l4" href="#additional-resources">Additional Resources</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../chaincode4ade/">Chaincode for Developers</a>
                </li>
                <li class="">
                    
    <a class="" href="../chaincode4noah/">Chaincode for Operations</a>
                </li>
                <li class="">
                    
    <a class="" href="../tbd/">DRIVENET Tutorial</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Reference material</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../arch-deep-dive/">Architecture Explained</a>
                </li>
                <li class="">
                    
    <a class="" href="../capabilities/">Capabilities</a>
                </li>
                <li class="">
                    
    <a class="" href="../fabric_model/">Fabric Model</a>
                </li>
                <li class="">
                    
    <a class="" href="../channels/">Channels</a>
                </li>
                <li class="">
                    
    <a class="" href="../gossip/">Gossip</a>
                </li>
                <li class="">
                    
    <a class="" href="../glossary/">Glossary</a>
                </li>
                <li class="">
                    
    <a class="" href="../kafka/">Kafka</a>
                </li>
                <li class="">
                    
    <a class="" href="../ledger/">Ledger</a>
                </li>
                <li class="">
                    
    <a class="" href="../fabric-FAQ/">FAQ</a>
                </li>
                <li class="">
                    
    <a class="" href="../releases/">Release Notes</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../questions/">General Help</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="../CONTRIBUTING/">Contributing</a>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="..">Hyperledger Fabric Documentaion</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="..">Docs</a> &raquo;</li>
    
      
        
          <li>Tutorials and samples &raquo;</li>
        
      
    
    <li>Writing Your First Application</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="writing-your-first-application">Writing Your First Application</h1>
<p>::: {.note}
::: {.admonition-title}
Note
:::</p>
<p>If you\'re not yet familiar with the fundamental architecture of a</p>
<p>:   Fabric network, you may want to visit the [blockchain]{role="doc"}
    and [build_network]{role="doc"} documentation prior to continuing.
:::</p>
<p>In this section we\'ll be looking at a handful of sample programs to see
how Fabric apps work. These apps (and the smart contract they use) --
collectively known as <code>fabcar</code> -- provide a broad demonstration of
Fabric functionality. Notably, we will show the process for interacting
with a Certificate Authority and generating enrollment certificates,
after which we will leverage these generated identities (user objects)
to query and update a ledger.</p>
<p>We'll go through three principle steps:</p>
<blockquote>
<p><strong>1. Setting up a development environment.</strong> Our application needs a
network to interact with, so we\'ll download one stripped down to just
the components we need for registration/enrollment, queries and
updates:</p>
<p><img alt="image" src="../images/AppConceptsOverview.png" /></p>
<p><strong>2. Learning the parameters of the sample smart contract our app will
use.</strong> Our smart contract contains various functions that allow us to
interact with the ledger in different ways. We'll go in and inspect
that smart contract to learn about the functions our applications will
be using.</p>
<p><strong>3. Developing the applications to be able to query and update assets
on the ledger.</strong> We\'ll get into the app code itself (our apps have
been written in Javascript) and manually manipulate the variables to
run different kinds of queries and updates.</p>
</blockquote>
<p>After completing this tutorial you should have a basic understanding of
how an application is programmed in conjunction with a smart contract to
interact with the ledger (i.e. the peer) on a Fabric network.</p>
<h2 id="setting-up-your-dev-environment">Setting up your Dev Environment</h2>
<p>First thing, let\'s download the Fabric images and the accompanying
artifacts for the network and applications...</p>
<p>Visit the [prereqs]{role="doc"} page and ensure you have the necessary
dependencies installed on your machine.</p>
<p>Next, visit the [samples]{role="doc"} page and follow the provided
instructions. Return to this tutorial once you have cloned the
<code>fabric-samples</code> repository, and downloaded the latest stable Fabric
images and available utilities.</p>
<p>At this point everything should be installed. Navigate to the <code>fabcar</code>
subdirectory within your <code>fabric-samples</code> repository and take a look at
what\'s inside:</p>
<p>``` {.sourceCode .bash}
cd fabric-samples/fabcar  &amp;&amp; ls</p>
<pre><code>
You should see the following:

``` {.sourceCode .bash}
enrollAdmin.js invoke.js   package.json    query.js    registerUser.js startFabric.sh
</code></pre>

<p>Before starting we also need to do a little housekeeping. Run the
following command to kill any stale or active containers:</p>
<p>``` {.sourceCode .bash}
docker rm -f $(docker ps -aq)</p>
<pre><code>
Clear any cached networks:

``` {.sourceCode .bash}
# Press 'y' when prompted by the command

docker network prune
</code></pre>

<p>And lastly if you\'ve already run through this tutorial, you\'ll also
want to delete the underlying chaincode image for the <code>fabcar</code> smart
contract. If you\'re a user going through this content for the first
time, then you won\'t have this chaincode image on your system:</p>
<p>``` {.sourceCode .bash}
docker rmi dev-peer0.org1.example.com-fabcar-1.0-5c906e402ed29f20260ae42283216aa75549c571e2e380f3615826365d8269ba</p>
<pre><code>
### Install the clients &amp; launch the network

::: {.note}
::: {.admonition-title}
Note
:::

The following instructions require you to be in the `fabcar` subdirectory

:   within your local clone of the `fabric-samples` repo. Remain at the
    root of this subdirectory for the remainder of this tutorial.
:::

Run the following command to install the Fabric dependencies for the
applications. We are concerned with `fabric-ca-client` which will allow
our app(s) to communicate with the CA server and retrieve identity
material, and with `fabric-client` which allows us to load the identity
material and talk to the peers and ordering service.

``` {.sourceCode .bash}
npm install
</code></pre>

<p>Launch your network using the <code>startFabric.sh</code> shell script. This
command will spin up our various Fabric entities and launch a smart
contract container for chaincode written in Golang:</p>
<p>``` {.sourceCode .bash}
./startFabric.sh</p>
<pre><code>
You also have the option of running this tutorial against chaincode
written in Node.js. If you\'d like to pursue this route, issue the
following command instead:

``` {.sourceCode .bash}
./startFabric.sh node
</code></pre>

<p>::: {.note}
::: {.admonition-title}
Note
:::</p>
<p>Be aware that the Node.js chaincode scenario will take roughly 90 seconds</p>
<p>:   to complete; perhaps longer. The script is not hanging, rather the
    increased time is a result of the fabric-shim being installed as the
    chaincode image is being built.
:::</p>
<p>Alright, now that you've got a sample network and some code, let's take
a look at how the different pieces fit together.</p>
<h2 id="how-applications-interact-with-the-network">How Applications Interact with the Network</h2>
<p>For a more in-depth look at the components in our <code>fabcar</code> network (and
how they\'re deployed) as well as how applications interact with those
components on more of a granular level, see
[understand_fabcar_network]{role="doc"}.</p>
<p>Developers more interested in seeing what applications <strong>do</strong> -- as
well as looking at the code itself to see how an application is
constructed -- should continue. For now, the most important thing to
know is that applications use a software development kit (SDK) to access
the <strong>APIs</strong> that permit queries and updates to the ledger.</p>
<h2 id="enrolling-the-admin-user">Enrolling the Admin User</h2>
<p>::: {.note}
::: {.admonition-title}
Note
:::</p>
<p>The following two sections involve communication with the Certificate</p>
<p>:   Authority. You may find it useful to stream the CA logs when running
    the upcoming programs.
:::</p>
<p>To stream your CA logs, split your terminal or open a new shell and
issue the following:</p>
<p>``` {.sourceCode .bash}
docker logs -f ca.example.com</p>
<pre><code>
Now hop back to your terminal with the `fabcar` content\...

When we launched our network, an admin user - `admin` - was registered
with our Certificate Authority. Now we need to send an enroll call to
the CA server and retrieve the enrollment certificate (eCert) for this
user. We won\'t delve into enrollment details here, but suffice it to
say that the SDK and by extension our applications need this cert in
order to form a user object for the admin. We will then use this admin
object to subsequently register and enroll a new user. Send the admin
enroll call to the CA server:

``` {.sourceCode .bash}
node enrollAdmin.js
</code></pre>

<p>This program will invoke a certificate signing request (CSR) and
ultimately output an eCert and key material into a newly created folder
- <code>hfc-key-store</code> - at the root of this project. Our apps will then look
to this location when they need to create or load the identity objects
for our various users.</p>
<h2 id="register-and-enroll-user1">Register and Enroll <code>user1</code></h2>
<p>With our newly generated admin eCert, we will now communicate with the
CA server once more to register and enroll a new user. This user -
<code>user1</code> - will be the identity we use when querying and updating the
ledger. It\'s important to note here that it is the <code>admin</code> identity
that is issuing the registration and enrollment calls for our new user
(i.e. this user is acting in the role of a registrar). Send the register
and enroll calls for <code>user1</code>:</p>
<p>``` {.sourceCode .bash}
node registerUser.js</p>
<pre><code>
Similar to the admin enrollment, this program invokes a CSR and outputs
the keys and eCert into the `hfc-key-store` subdirectory. So now we have
identity material for two separate users - `admin` &amp; `user1`. Time to
interact with the ledger\...

Querying the Ledger
-------------------

Queries are how you read data from the ledger. This data is stored as a
series of key/value pairs, and you can query for the value of a single
key, multiple keys, or \-- if the ledger is written in a rich data
storage format like JSON \--perform complex searches against it (looking
for all assets that contain certain keywords, for example).

This is a representation of how a query works:

![image](images/QueryingtheLedger.png)

First, let\'s run our `query.js` program to return a listing of all the
cars on the ledger. We will use our second identity - `user1` - as the
signing entity for this application. The following line in our program
specifies `user1` as the signer:

``` {.sourceCode .bash}
fabric_client.getUserContext('user1', true);
</code></pre>

<p>Recall that the <code>user1</code> enrollment material has already been placed into
our <code>hfc-key-store</code> subdirectory, so we simply need to tell our
application to grab that identity. With the user object defined, we can
now proceed with reading from the ledger. A function that will query all
the cars, <code>queryAllCars</code>, is pre-loaded in the app, so we can simply run
the program as is:</p>
<p>``` {.sourceCode .bash}
node query.js</p>
<pre><code>
It should return something like this:

``` {.sourceCode .json}
Successfully loaded user1 from persistence
Query has completed, checking results
Response is  [{&quot;Key&quot;:&quot;CAR0&quot;, &quot;Record&quot;:{&quot;colour&quot;:&quot;blue&quot;,&quot;make&quot;:&quot;Toyota&quot;,&quot;model&quot;:&quot;Prius&quot;,&quot;owner&quot;:&quot;Tomoko&quot;}},
{&quot;Key&quot;:&quot;CAR1&quot;,   &quot;Record&quot;:{&quot;colour&quot;:&quot;red&quot;,&quot;make&quot;:&quot;Ford&quot;,&quot;model&quot;:&quot;Mustang&quot;,&quot;owner&quot;:&quot;Brad&quot;}},
{&quot;Key&quot;:&quot;CAR2&quot;, &quot;Record&quot;:{&quot;colour&quot;:&quot;green&quot;,&quot;make&quot;:&quot;Hyundai&quot;,&quot;model&quot;:&quot;Tucson&quot;,&quot;owner&quot;:&quot;Jin Soo&quot;}},
{&quot;Key&quot;:&quot;CAR3&quot;, &quot;Record&quot;:{&quot;colour&quot;:&quot;yellow&quot;,&quot;make&quot;:&quot;Volkswagen&quot;,&quot;model&quot;:&quot;Passat&quot;,&quot;owner&quot;:&quot;Max&quot;}},
{&quot;Key&quot;:&quot;CAR4&quot;, &quot;Record&quot;:{&quot;colour&quot;:&quot;black&quot;,&quot;make&quot;:&quot;Tesla&quot;,&quot;model&quot;:&quot;S&quot;,&quot;owner&quot;:&quot;Adriana&quot;}},
{&quot;Key&quot;:&quot;CAR5&quot;, &quot;Record&quot;:{&quot;colour&quot;:&quot;purple&quot;,&quot;make&quot;:&quot;Peugeot&quot;,&quot;model&quot;:&quot;205&quot;,&quot;owner&quot;:&quot;Michel&quot;}},
{&quot;Key&quot;:&quot;CAR6&quot;, &quot;Record&quot;:{&quot;colour&quot;:&quot;white&quot;,&quot;make&quot;:&quot;Chery&quot;,&quot;model&quot;:&quot;S22L&quot;,&quot;owner&quot;:&quot;Aarav&quot;}},
{&quot;Key&quot;:&quot;CAR7&quot;, &quot;Record&quot;:{&quot;colour&quot;:&quot;violet&quot;,&quot;make&quot;:&quot;Fiat&quot;,&quot;model&quot;:&quot;Punto&quot;,&quot;owner&quot;:&quot;Pari&quot;}},
{&quot;Key&quot;:&quot;CAR8&quot;, &quot;Record&quot;:{&quot;colour&quot;:&quot;indigo&quot;,&quot;make&quot;:&quot;Tata&quot;,&quot;model&quot;:&quot;Nano&quot;,&quot;owner&quot;:&quot;Valeria&quot;}},
{&quot;Key&quot;:&quot;CAR9&quot;, &quot;Record&quot;:{&quot;colour&quot;:&quot;brown&quot;,&quot;make&quot;:&quot;Holden&quot;,&quot;model&quot;:&quot;Barina&quot;,&quot;owner&quot;:&quot;Shotaro&quot;}}]
</code></pre>

<p>These are the 10 cars. A black Tesla Model S owned by Adriana, a red
Ford Mustang owned by Brad, a violet Fiat Punto owned by Pari, and so
on. The ledger is key/value based and in our implementation the key is
<code>CAR0</code> through <code>CAR9</code>. This will become particularly important in a
moment.</p>
<p>Let\'s take a closer look at this program. Use an editor (e.g. atom or
visual studio) and open <code>query.js</code>.</p>
<p>The initial section of the application defines certain variables such as
channel name, cert store location and network endpoints. In our sample
app, these variables have been baked-in, but in a real app these
variables would have to be specified by the app dev.</p>
<p>``` {.sourceCode .bash}
var channel = fabric_client.newChannel('mychannel');
var peer = fabric_client.newPeer('grpc://localhost:7051');
channel.addPeer(peer);</p>
<p>var member_user = null;
var store_path = path.join(__dirname, 'hfc-key-store');
console.log('Store path:'+store_path);
var tx_id = null;</p>
<pre><code>
This is the chunk where we construct our query:

``` {.sourceCode .bash}
// queryCar chaincode function - requires 1 argument, ex: args: ['CAR4'],
// queryAllCars chaincode function - requires no arguments , ex: args: [''],
const request = {
  //targets : --- letting this default to the peers assigned to the channel
  chaincodeId: 'fabcar',
  fcn: 'queryAllCars',
  args: ['']
};
</code></pre>

<p>When the application ran, it invoked the <code>fabcar</code> chaincode on the peer,
ran the <code>queryAllCars</code> function within it, and passed no arguments to
it.</p>
<p>To take a look at the available functions within our smart contract,
navigate to the <code>chaincode/fabcar/go</code> subdirectory at the root of
<code>fabric-samples</code> and open <code>fabcar.go</code> in your editor.</p>
<p>::: {.note}
::: {.admonition-title}
Note
:::</p>
<p>These same functions are defined within the Node.js version of the</p>
<p>:   <code>fabcar</code> chaincode.
:::</p>
<p>You\'ll see that we have the following functions available to call:
<code>initLedger</code>, <code>queryCar</code>, <code>queryAllCars</code>, <code>createCar</code>, and
<code>changeCarOwner</code>.</p>
<p>Let\'s take a closer look at the <code>queryAllCars</code> function to see how it
interacts with the ledger.</p>
<p>``` {.sourceCode .bash}
func (s *SmartContract) queryAllCars(APIstub shim.ChaincodeStubInterface) sc.Response {</p>
<p>startKey := "CAR0"
  endKey := "CAR999"</p>
<p>resultsIterator, err := APIstub.GetStateByRange(startKey, endKey)</p>
<pre><code>
This defines the range of `queryAllCars`. Every car between `CAR0` and
`CAR999` \-- 1,000 cars in all, assuming every key has been tagged
properly \-- will be returned by the query.

Below is a representation of how an app would call different functions
in chaincode. Each function must be coded against an available API in
the chaincode shim interface, which in turn allows the smart contract
container to properly interface with the peer ledger.

![image](images/RunningtheSample.png)

We can see our `queryAllCars` function, as well as one called
`createCar`, that will allow us to update the ledger and ultimately
append a new block to the chain in a moment.

But first, go back to the `query.js` program and edit the constructor
request to query `CAR4`. We do this by changing the function in
`query.js` from `queryAllCars` to `queryCar` and passing `CAR4` as the
specific key.

The `query.js` program should now look like this:

``` {.sourceCode .bash}
const request = {
  //targets : --- letting this default to the peers assigned to the channel
  chaincodeId: 'fabcar',
  fcn: 'queryCar',
  args: ['CAR4']
};
</code></pre>

<p>Save the program and navigate back to your <code>fabcar</code> directory. Now run
the program again:</p>
<p>``` {.sourceCode .bash}
node query.js</p>
<pre><code>
You should see the following:

``` {.sourceCode .json}
{&quot;colour&quot;:&quot;black&quot;,&quot;make&quot;:&quot;Tesla&quot;,&quot;model&quot;:&quot;S&quot;,&quot;owner&quot;:&quot;Adriana&quot;}
</code></pre>

<p>If you go back and look at the result from when we queried every car
before, you can see that <code>CAR4</code> was Adriana's black Tesla model S, which
is the result that was returned here.</p>
<p>Using the <code>queryCar</code> function, we can query against any key (e.g.
<code>CAR0</code>) and get whatever make, model, color, and owner correspond to
that car.</p>
<p>Great. At this point you should be comfortable with the basic query
functions in the smart contract and the handful of parameters in the
query program. Time to update the ledger...</p>
<h2 id="updating-the-ledger">Updating the Ledger</h2>
<p>Now that we've done a few ledger queries and added a bit of code, we're
ready to update the ledger. There are a lot of potential updates we
could make, but let\'s start by creating a car.</p>
<p>Below we can see how this process works. An update is proposed,
endorsed, then returned to the application, which in turn sends it to be
ordered and written to every peer\'s ledger:</p>
<p><img alt="image" src="../images/UpdatingtheLedger.png" /></p>
<p>Our first update to the ledger will be to create a new car. We have a
separate Javascript program -- <code>invoke.js</code> -- that we will use to make
updates. Just as with queries, use an editor to open the program and
navigate to the code block where we construct our invocation:</p>
<p>``` {.sourceCode .bash}
// createCar chaincode function - requires 5 args, ex: args: ['CAR12', 'Honda', 'Accord', 'Black', 'Tom'],
// changeCarOwner chaincode function - requires 2 args , ex: args: ['CAR10', 'Barry'],
// must send the proposal to endorsing peers
var request = {
  //targets: let default to the peer assigned to the client
  chaincodeId: 'fabcar',
  fcn: '',
  args: [''],
  chainId: 'mychannel',
  txId: tx_id
};</p>
<pre><code>
You\'ll see that we can call one of two functions - `createCar` or
`changeCarOwner`. First, let's create a red Chevy Volt and give it to an
owner named Nick. We\'re up to `CAR9` on our ledger, so we\'ll use
`CAR10` as the identifying key here. Edit this code block to look like
this:

``` {.sourceCode .bash}
var request = {
  //targets: let default to the peer assigned to the client
  chaincodeId: 'fabcar',
  fcn: 'createCar',
  args: ['CAR10', 'Chevy', 'Volt', 'Red', 'Nick'],
  chainId: 'mychannel',
  txId: tx_id
};
</code></pre>

<p>Save it and run the program:</p>
<p>``` {.sourceCode .bash}
node invoke.js</p>
<pre><code>
There will be some output in the terminal about `ProposalResponse` and
promises. However, all we\'re concerned with is this message:

``` {.sourceCode .bash}
The transaction has been committed on peer localhost:7053
</code></pre>

<p>To see that this transaction has been written, go back to <code>query.js</code> and
change the argument from <code>CAR4</code> to <code>CAR10</code>.</p>
<p>In other words, change this:</p>
<p>``` {.sourceCode .bash}
const request = {
  //targets : --- letting this default to the peers assigned to the channel
  chaincodeId: 'fabcar',
  fcn: 'queryCar',
  args: ['CAR4']
};</p>
<pre><code>
To this:

``` {.sourceCode .bash}
const request = {
  //targets : --- letting this default to the peers assigned to the channel
  chaincodeId: 'fabcar',
  fcn: 'queryCar',
  args: ['CAR10']
};
</code></pre>

<p>Save once again, then query:</p>
<p>``` {.sourceCode .bash}
node query.js</p>
<pre><code>
Which should return this:

``` {.sourceCode .bash}
Response is  {&quot;colour&quot;:&quot;Red&quot;,&quot;make&quot;:&quot;Chevy&quot;,&quot;model&quot;:&quot;Volt&quot;,&quot;owner&quot;:&quot;Nick&quot;}
</code></pre>

<p>Congratulations. You've created a car!</p>
<p>So now that we've done that, let's say that Nick is feeling generous and
he wants to give his Chevy Volt to someone named Dave.</p>
<p>To do this go back to <code>invoke.js</code> and change the function from
<code>createCar</code> to <code>changeCarOwner</code> and input the arguments like this:</p>
<p>``` {.sourceCode .bash}
var request = {
  //targets: let default to the peer assigned to the client
  chaincodeId: 'fabcar',
  fcn: 'changeCarOwner',
  args: ['CAR10', 'Dave'],
  chainId: 'mychannel',
  txId: tx_id
};</p>
<pre><code>
The first argument \-- `CAR10` \-- reflects the car that will be
changing owners. The second argument \-- `Dave` \-- defines the new
owner of the car.

Save and execute the program again:

``` {.sourceCode .bash}
node invoke.js
</code></pre>

<p>Now let's query the ledger again and ensure that Dave is now associated
with the <code>CAR10</code> key:</p>
<p>``` {.sourceCode .bash}
node query.js</p>
<pre><code>
It should return this result:

``` {.sourceCode .bash}
Response is  {&quot;colour&quot;:&quot;Red&quot;,&quot;make&quot;:&quot;Chevy&quot;,&quot;model&quot;:&quot;Volt&quot;,&quot;owner&quot;:&quot;Dave&quot;}
</code></pre>

<p>The ownership of <code>CAR10</code> has been changed from Nick to Dave.</p>
<p>::: {.note}
::: {.admonition-title}
Note
:::</p>
<p>In a real world application the chaincode would likely have some access</p>
<p>:   control logic. For example, only certain authorized users may create
    new cars, and only the car owner may transfer the car to somebody
    else.
:::</p>
<h2 id="summary">Summary</h2>
<p>Now that we've done a few queries and a few updates, you should have a
pretty good sense of how applications interact with the network. You've
seen the basics of the roles smart contracts, APIs, and the SDK play in
queries and updates and you should have a feel for how different kinds
of applications could be used to perform other business tasks and
operations.</p>
<p>In subsequent documents we'll learn how to actually <strong>write</strong> a smart
contract and how some of these more low level application functions can
be leveraged (especially relating to identity and membership services).</p>
<h2 id="additional-resources">Additional Resources</h2>
<p>The <a href="https://github.com/hyperledger/fabric-sdk-node">Hyperledger Fabric Node SDK
repo</a> is an excellent
resource for deeper documentation and sample code. You can also consult
the Fabric community and component experts on <a href="https://chat.hyperledger.org/home">Hyperledger Rocket
Chat</a>.</p>
<p><a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a></p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../chaincode4ade/" class="btn btn-neutral float-right" title="Chaincode for Developers">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../build_network/" class="btn btn-neutral" title="Build Your First Network"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>Copyright &copy; 2017 Linux Foundation All Rights Reserved</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../build_network/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../chaincode4ade/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '..';</script>
    <script src="../js/theme.js"></script>
      <script src="../search/require.js"></script>
      <script src="../search/search.js"></script>

</body>
</html>
